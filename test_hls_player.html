<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HLS Video Player Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .video-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin: 20px 0;
        }
        video {
            width: 100%;
            max-height: 400px;
            border-radius: 4px;
        }
        .info {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            border-left: 4px solid #2196F3;
        }
        .quality-selector {
            margin: 15px 0;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976D2;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>üé¨ HLS Video Streaming Test</h1>

    <div class="info">
        <h3>Video Information:</h3>
        <p><strong>Lecture:</strong> Test Lecture</p>
        <p><strong>Duration:</strong> 8 seconds</p>
        <p><strong>Qualities:</strong> 1080p, 720p, 480p, 360p</p>
        <p><strong>Format:</strong> HLS (HTTP Live Streaming)</p>
    </div>

    <div class="video-container">
        <h3>üé• Video Player</h3>

        <div class="quality-selector">
            <button onclick="loadQuality('master')">Auto Quality (Master Playlist)</button>
            <button onclick="loadQuality('1080p')">1080p HD</button>
            <button onclick="loadQuality('720p')">720p HD</button>
            <button onclick="loadQuality('480p')">480p SD</button>
            <button onclick="loadQuality('360p')">360p Mobile</button>
        </div>

        <video id="videoPlayer" controls poster="">
            Your browser does not support the video tag.
        </video>

        <div id="status" class="status success">
            Click a quality button above to start playing the video.
        </div>
    </div>

    <div class="info">
        <h3>üìã HLS URLs:</h3>
        <ul>
            <li><strong>Master Playlist:</strong> <code>http://127.0.0.1:8002/media/lecture_videos/hls/lecture_1_playlist.m3u8</code></li>
            <li><strong>1080p:</strong> <code>http://127.0.0.1:8002/media/lecture_videos/hls/lecture_1_1080p/lecture_1_1080p.m3u8</code></li>
            <li><strong>720p:</strong> <code>http://127.0.0.1:8002/media/lecture_videos/hls/lecture_1_720p/lecture_1_720p.m3u8</code></li>
            <li><strong>480p:</strong> <code>http://127.0.0.1:8002/media/lecture_videos/hls/lecture_1_480p/lecture_1_480p.m3u8</code></li>
            <li><strong>360p:</strong> <code>http://127.0.0.1:8002/media/lecture_videos/hls/lecture_1_360p/lecture_1_360p.m3u8</code></li>
        </ul>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const video = document.getElementById('videoPlayer');
        const statusDiv = document.getElementById('status');
        let hls = null;

        function updateStatus(message, isError = false) {
            statusDiv.textContent = message;
            statusDiv.className = `status ${isError ? 'error' : 'success'}`;
        }

        function loadQuality(quality) {
            // Destroy existing HLS instance
            if (hls) {
                hls.destroy();
            }

            let playlistUrl;
            switch(quality) {
                case 'master':
                    playlistUrl = 'http://127.0.0.1:8002/media/lecture_videos/hls/lecture_1_playlist.m3u8';
                    break;
                case '1080p':
                    playlistUrl = 'http://127.0.0.1:8002/media/lecture_videos/hls/lecture_1_1080p/lecture_1_1080p.m3u8';
                    break;
                case '720p':
                    playlistUrl = 'http://127.0.0.1:8002/media/lecture_videos/hls/lecture_1_720p/lecture_1_720p.m3u8';
                    break;
                case '480p':
                    playlistUrl = 'http://127.0.0.1:8002/media/lecture_videos/hls/lecture_1_480p/lecture_1_480p.m3u8';
                    break;
                case '360p':
                    playlistUrl = 'http://127.0.0.1:8002/media/lecture_videos/hls/lecture_1_360p/lecture_1_360p.m3u8';
                    break;
                default:
                    updateStatus('Invalid quality selected', true);
                    return;
            }

            updateStatus(`Loading ${quality} quality...`);

            if (Hls.isSupported()) {
                hls = new Hls({
                    debug: true,
                    enableWorker: true,
                    lowLatencyMode: true,
                });

                hls.loadSource(playlistUrl);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, function(event, data) {
                    updateStatus(`‚úÖ ${quality} quality loaded! (${data.levels.length} quality levels available)`);
                    console.log('Manifest parsed, found ' + data.levels.length + ' quality levels');
                });

                hls.on(Hls.Events.ERROR, function(event, data) {
                    console.error('HLS Error:', data);
                    updateStatus(`‚ùå HLS Error: ${data.details}`, true);
                });

                hls.on(Hls.Events.LEVEL_SWITCHED, function(event, data) {
                    console.log('Quality switched to level:', data.level);
                    updateStatus(`üîÑ Switched to quality level: ${data.level}`);
                });

            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Native HLS support (Safari)
                video.src = playlistUrl;
                updateStatus(`‚úÖ ${quality} quality loaded (Native HLS)`);
            } else {
                updateStatus('‚ùå HLS is not supported in this browser', true);
            }
        }

        // Auto-load master playlist on page load
        window.addEventListener('load', function() {
            updateStatus('Page loaded. Click a quality button to start playing.');
        });

        // Video event listeners
        video.addEventListener('play', function() {
            updateStatus('‚ñ∂Ô∏è Video playing...');
        });

        video.addEventListener('pause', function() {
            updateStatus('‚è∏Ô∏è Video paused');
        });

        video.addEventListener('ended', function() {
            updateStatus('üèÅ Video ended');
        });

        video.addEventListener('error', function() {
            updateStatus('‚ùå Video playback error', true);
        });
    </script>
</body>
</html>
